import { Component } from '@angular/core';
import { theme } from '../assets/map_theme';
import { environment } from '../environments/environment';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})

export class AppComponent {
	//Initial lat/lng for the map
	//TODO: Get user location
	lat: number = 42;
	lng: number = -84;

	//marker icons
	locationIcon: string = '../assets/mapdotred.png';
	icons = {
		phishing: '../assets/mapdotred.png',
		trojan: '../assets/mapdotorange.png',
		exploit: '../assets/mapdotblue.png',
		other: '../assets/mapdotpurple.png',
	};
	theme = theme;
	showInfoWindow: Boolean = false;
	markers = [];
	categoryCollapsed = {
		phishing: true,
		trojan: true,
		exploit: true,
		other: true
	}

	//List of malware
	//Includes URL, description, etc
	malware = {};
	
	// Returns all category names
	categoryKeys = () => { return Object.keys(this.malware) }
	
	// Returns the ips for a category of malware
	malwareKeys = (category) => { return Object.keys(this.malware[category]) }
	
	// Returns the number of malware instances in all categories
	malwareCounts = () => {
		var ret = [];
		for(let cat of this.categoryKeys()) {
			ret.push(Object.keys(this.malware[cat]).length);
		}
		return ret;
	}

	// Shows a clicked malware in the info pane
	showMalware(cat, ip) {
		this.showInfoWindow = true;
		console.log('clicked ' + ip + ':' + cat);
		console.log(this.malware[cat][ip]);
		this.categoryCollapsed[cat] = false;
		this.malware[cat][ip].collapsed = false;
		document.getElementById(ip).scrollIntoView();
	}
	
	// Toggles the information pane
	toggleInfo = () => { this.showInfoWindow = !this.showInfoWindow };

	//When we initialize the component, get the data from server
	ngOnInit() {
		//Get the malware list
		fetch(environment.api_url + '/api/rawdata').then(response => {
			if (response.ok) {
				response.json().then(json => {
					// console.log(json)
					this.malware = json;
				});
			}
		});
	}

	hideLoadingScreen() {

	}
}